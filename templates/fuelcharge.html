{% extends 'technician_dashboard.html' %}
{% load static %}

{% block title %}
fuelcharge
{% endblock %}

{% block content %}

<link rel="stylesheet" href="{% static 'css/fuelcharge.css' %}">



<div class="mt-0">
    <nav class="navbar navbar-expand-lg bg-light shadow rounded custom-navbar" style="width: 85%; margin-top: 5px; margin-left: 225px;"  >
        <div class="container-fluid" >
            <div class="custom-navbar d-flex">
                <ul class="navbar-nav d-flex flex-row overflow-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'technician_dashboard' %}">
                            <i class="bi bi-arrow-left"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'fuelcharge' %}fw-bold active{% endif %}" 
                           href="{% url 'fuelcharge' apply.id %}">Fuel Charge</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'food_allowance' %}fw-bold active{% endif %}" 
                           href="{% url 'food_allowance' apply.id %}">Food Allowance</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'item_purchased' %}fw-bold active{% endif %}" 
                           href="{% url 'item_purchased' apply.id %}">Item Purchased</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'vendor_info' %}fw-bold active{% endif %}" 
                           href="{% url 'vendor_info' apply.id %}">Vendor Info</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    

  <div class="container" style="width: 85%; margin-top: 5px; margin-left: 225px;">
      <div class="card p-4">
          <div class="card-body">
              <form action="{% url 'fuelcharge' apply.id %}" method="post">
                  {% csrf_token %}
                  <div class="row">
                      <div class="col-md-3">
                          <label for="technician_name">Technician Name</label>
                          <input type="text" class="form-control" id="technician_name" name="technician_name" value="{{ technician_name }}" required />
                      </div>
                      <div class="col-md-3">
                          <label for="date">Date</label>
                          <input type="date" class="form-control" name="date" id="date" />
                      </div>
                      <div class="col-md-3">
                          <label for="purpose">Purpose</label>
                          <input type="text" class="form-control" id="purpose" name="purpose" />
                      </div>
                      <div class="col-md-3">
                          <label for="kilometers">Kilometers</label>
                          <input type="number" class="form-control" id="kilometers" name="kilometers" />
                      </div>
                  </div>
                  <div class="mt-3 text-end">
                      <button class="btn btn-primary" type="submit">Add</button>
                  </div>
              </form>
          </div>
      </div>
  </div>

  <div class="table-container mt-4" style="padding-left: 230px;">
      {% if fuel_charges %}
      <table class="table table-striped table-bordered">
          <thead>
              <tr>
                  <th>Customer Name</th>
                  <th>Issue</th>
                  <th>Technician Name</th>
                  <th>Date</th>
                  <th>Purpose</th>
                  <th>Kilometer</th>
                  <th>Cost</th>
                  <th>Actions</th>
              </tr>
          </thead>
          <tbody>
              {% for d in fuel_charges %}
              <tr>
                  <td>{{ d.customer_name }}</td>
                  <td>{{ d.issue }}</td>
                  <td>{{ d.technician_name }}</td>
                  <td>{{ d.date }}</td>
                  <td>{{ d.purpose }}</td>
                  <td>{{ d.kilometers }}</td>
                  <td>{{ d.cost }}</td>
                  <td>
                      <a href="{% url 'update_fuelcharge' d.id %}" class="edit-fuel-btn" data-bs-toggle="modal" data-bs-target="#updateFuelModal{{ d.id }}">
                          <i class="fa fa-pencil-alt" title="Update"></i>
                      </a>

                      <button type="button" class="delete-icon" title="Delete" data-bs-toggle="modal" data-bs-target="#deleteFuelChargeModal{{ d.id }}">
                          <i class="fa fa-trash"></i>
                      </button>

                      <!-- Delete Confirmation Modal -->
                      <div class="modal fade" id="deleteFuelChargeModal{{ d.id }}" tabindex="-1">
                          <div class="modal-dialog">
                              <div class="modal-content">
                                  <div class="modal-header">
                                      <h5 class="modal-title">Confirm Delete</h5>
                                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                  </div>
                                  <div class="modal-body">
                                      <p>Are you sure you want to delete this fuel charge?</p>
                                  </div>
                                  <div class="modal-footer">
                                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                      <form action="{% url 'delete_fuelcharge' d.id %}" method="post">
                                          {% csrf_token %}
                                          <button type="submit" class="btn btn-danger">Delete</button>
                                      </form>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </td>
              </tr>
              {% endfor %}
          </tbody>
      </table>

      <!-- Update Fuel Charge Modal -->
      {% for d in fuel_charges %}
      <div class="modal fade" id="updateFuelModal{{ d.id }}" tabindex="-1">
          <div class="modal-dialog">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title">Update Fuel Charge</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body">
                      <form method="POST" action="{% url 'update_fuelcharge' d.id %}">
                          {% csrf_token %}
                          <input type="hidden" name="fuel_id" value="{{ d.id }}">

                          <label>Technician Name</label>
                          <input type="text" class="form-control" name="technician_name" value="{{ d.technician_name }}">

                          <label>Date</label>
                          <input type="date" class="form-control" name="date" value="{{ d.date|date:'Y-m-d' }}">

                          <label>Purpose</label>
                          <input type="text" class="form-control" name="purpose" value="{{ d.purpose }}">

                          <label>Kilometers</label>
                          <input type="number" class="form-control" name="kilometers" value="{{ d.kilometers }}">

                          <label>Cost</label>
                          <input type="number" step="0.01" class="form-control" name="cost" value="{{ d.cost }}">

                          <button type="submit" class="btn btn-primary mt-3">Update</button>
                      </form>
                  </div>
              </div>
          </div>
      </div>
      {% endfor %}

      {% else %}
      <div class="alert alert-warning text-center">
          No fuel charge available. Please add data.
      </div>
      {% endif %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}
